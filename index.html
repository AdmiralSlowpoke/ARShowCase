<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR.js AR Quiz Multi-Question</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

    <style>
      body, html { margin: 0; overflow: hidden; font-family: sans-serif; }

      #quiz {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 15px 25px;
        border-radius: 10px;
        text-align: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
      }

      #quiz.show {
        opacity: 1;
        pointer-events: auto;
      }

      #quiz button {
        margin: 5px;
        padding: 8px 12px;
        font-size: 16px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      renderer="precision: mediump">

      <a-assets>
        <img id="characterNormal" src="character.png">
      </a-assets>

      <a-marker preset="hiro" id="hiroMarker">
        <a-entity id="character"
                  geometry="primitive: plane; width: 1; height: 2"
                  material="src: #characterNormal; transparent: true;"
                  position="0 1 0"
                  look-at="[camera]">
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- HTML опрос -->
    <div id="quiz">
      <p id="questionText">Вопрос?</p>
      <div id="options"></div>
    </div>

    <script>
      const marker = document.querySelector("#hiroMarker");
      const quiz = document.querySelector("#quiz");
      const questionText = document.getElementById("questionText");
      const optionsDiv = document.getElementById("options");

      // Список вопросов
      const questions = [
        {
          text: "Кто это?",
          options: ["Вариант A", "Вариант B", "Вариант C"],
          correct: 1 // индекс правильного варианта
        },
        {
          text: "Какого цвета персонаж?",
          options: ["Красный", "Зелёный", "Синий"],
          correct: 1
        },
        {
          text: "Где стоит персонаж?",
          options: ["На потолке", "На маркере", "В воздухе"],
          correct: 1
        }
      ];

      let currentQuestion = 0;
      let quizActive = false;

      function showQuestion(index) {
        if (index >= questions.length) {
          questionText.textContent = "Вы прошли все вопросы!";
          optionsDiv.innerHTML = "";
          return;
        }

        const q = questions[index];
        questionText.textContent = q.text;
        optionsDiv.innerHTML = "";

        q.options.forEach((opt, i) => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.dataset.index = i;
          btn.addEventListener("click", () => handleAnswer(i));
          optionsDiv.appendChild(btn);
        });
      }

      function handleAnswer(selectedIndex) {
        if (!quizActive) return;
        quizActive = false;

        const q = questions[currentQuestion];
        const buttons = optionsDiv.querySelectorAll("button");

        // Подсветка
        buttons.forEach((btn, i) => {
          btn.disabled = true;
          if (i === q.correct) btn.style.background = "lightgreen";
          else if (i === selectedIndex) btn.style.background = "red";
        });

        // Переходим к следующему вопросу через 1.5 сек
        setTimeout(() => {
          currentQuestion++;
          quizActive = true;
          showQuestion(currentQuestion);
        }, 1500);
      }

      // Показ/скрытие опроса при появлении маркера
      marker.addEventListener("markerFound", () => {
        if (!quizActive) {
          quiz.classList.add("show");
          quizActive = true;
          showQuestion(currentQuestion);
        }
      });

      marker.addEventListener("markerLost", () => {
        quiz.classList.remove("show");
      });
    </script>
  </body>
</html>
